<%- include('../partials/header')%>

<h1 class="is-size-3"><strong>Country:</strong> <%= country.name %></h1>
<h1 class="is-size-3"><strong>Country Code:</strong> <%= country.iso_alpha2 %></h1>
<h1 class="is-size-3"><strong>Continent:</strong> <%= country.continent %></h1>
<h1 class="is-size-3"><strong>Recommendation:</strong> <%= country.advisory.message %></h1>


<% if (user) { %>

  <%  let ccMatch = user.favorites.some(function(favorite) { %>
    <%  return favorite.countryCode === country.iso_alpha2 %>
  <% }); %>

  <% if (ccMatch) { %>
        <form action="/favorites/<%= country.iso_alpha2 %>?_method=DELETE" method="POST">
            <button type="submit" name="countryCode" class="button is-danger">Delete Favorite</button>
        </form>
    <% } else { %>
        <form action="/favorites/<%= country.iso_alpha2 %>" method="POST">
            <button type="submit" name="countryCode" class="button is-success">Add Favorite</button>
        </form>
  <% }; %>

<% }; %>


<% comments.forEach(function(comment){ %>
    <article class="media">
        <figure class="media-left">
          <p class="image is-64x64">
            <img src="<%= comment.user.avatar %>" class="is-rounded">
          </p>
        </figure>
        <div class="media-content">
          <div class="content">
            <p>
              <strong><%= comment.user.name %></strong>
              <br>
              <%= comment.text %>
            </p>
          </div>
        </div>
        <div class="media-right">
          <button class="delete"></button>
        </div>
      </article>
<% }); %>


<% if (user) { %>

  <form action="/countries/<%= country.iso_alpha2 %>/comments" method="POST">
    <label>Share your experience traveling in this country!</label><br>
    <textarea name="text" cols="90" rows="5"></textarea><br>
    <input type="submit" value="Add a comment" class="button is-info">
  </form>

<% } else { %>

  <div>
    <p>Log in with Google to leave a commment.</p>
    <a href="/auth/google" class="button is-dark">Login with Google</a>
  </div>

<% } %>

<iframe
  width="600"
  height="450"
  frameborder="0" style="border:0"
  src="https://www.google.com/maps/embed/v1/place?key=<%= token %>&q=<%= country.name %>" allowfullscreen>
</iframe>

<div class="container mt-6 mb-4">
  <div class="notification">
      <h1 class="is-size-3 has-text-centered">Covid Data</h1>
  </div>
</div>

<% if(covidCountry) { %>

  <h1 class="is-size-3"><strong>Total Confirmed Cases:</strong> <%= covidCountry.TotalConfirmed %></h1>
  <h1 class="is-size-3"><strong>New Confirmed Cases:</strong> <%= covidCountry.NewConfirmed %></h1>
  <h1 class="is-size-3"><strong>New Deaths:</strong> <%= covidCountry.NewDeaths %></h1>
  <h1 class="is-size-3"><strong>Total Deaths:</strong> <%= covidCountry.TotalDeaths %></h1>
  <h1 class="is-size-3"><strong>New Recovered:</strong> <%= covidCountry.NewRecovered %></h1>
  <h1 class="is-size-3"><strong>Total Recovered:</strong> <%= covidCountry.TotalRecovered %></h1>
  <h1 class="is-size-3"><strong>Date Updated</strong> <%= covidCountry.Date %></h1>

<% } else { %>

  <h1 class="is-size-3"> Sorry, we currently don't have any COVID-19 data for <%= country.name %> </h1>

<% } %>


